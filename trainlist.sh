set -e
# TAG=conv5_yfcc_scratch_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh
# TAG=conv4_yfcc_init_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca.yaml bash schd.sh
# TAG=conv4_yfcc_scratch_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh
# TAG=conv4_in1k_scratch_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh
# TAG=conv4_in1k_init_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_cin1k.yaml bash schd.sh
# TAG=conv5_in1k_init_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca_cin1k.yaml bash schd.sh
# TAG=conv5_in1k_scratch_bnfreeze_pca CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh


# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_yfcc_init_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_yfcc_init_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_in1k_init_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_in1k_init_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
#
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_yfcc_scratch_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_in1k_scratch_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_yfcc_scratch_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_in1k_scratch_pca_recluster10_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 50050

# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_yfcc_scratch_pca_recluster1_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 5005
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_in1k_scratch_pca_recluster1_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 5005
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_yfcc_scratch_pca_recluster1_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 5005
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_in1k_scratch_pca_recluster1_5crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 5005

# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_yfcc_scratch_pca_recluster2_5crop_nopred CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_in1k_scratch_pca_recluster2_5crop_nopred CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_yfcc_scratch_pca_recluster2_5crop_nopred CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_in1k_scratch_pca_recluster2_5crop_nopred CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh
#
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_yfcc_scratch_pca_recluster2_1crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh TEST.TEN_CROP False
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv5_in1k_scratch_pca_recluster2_1crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh TEST.TEN_CROP False
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_yfcc_scratch_pca_recluster2_1crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh TEST.TEN_CROP False
# LAUNCHER=./deploy/cluster/recluster.sh TAG=conv4_in1k_scratch_pca_recluster2_1crop CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh TEST.TEN_CROP False

# for i in latest 10010 5005 ; do
#   TAG=conv4_yfcc_scratch_pca_centroid${i} CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml NAME=sigma5.0_top2_LR0.01_centroid${i} ./deploy/cluster/launch.sh MIDLEVEL.GAUSSIAN_TOPK 2 MIDLEVEL.GAUSSIAN_SIGMA 5.0 SOLVER.BASE_LR 0.01 MIDLEVEL.CENTROIDS_FILE /home/yihuihe/visouts/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca/sigma5.0_top2_LR0.01_FC16/${i}/centroids MIDLEVEL.RECLUSTER_PERIOD 100100000
# done
# ~/local/experimental/deeplearning/yihuihe/self_supervision/configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_stage2.yaml
# i=5005
# TAG=conv4_yfcc_init_pca_centroid${i} CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_stage2.yaml NAME=sigma5.0_top2_LR0.01_centroid${i} ./deploy/cluster/launch.sh MIDLEVEL.GAUSSIAN_TOPK 2 MIDLEVEL.GAUSSIAN_SIGMA 5.0 SOLVER.BASE_LR 0.01 MIDLEVEL.CENTROIDS_FILE /home/yihuihe/visouts/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca/sigma5.0_top2_LR0.01_FC16/${i}/centroids TRAIN.PARAMS_FILE /home/yihuihe/20190712/sigma5.0_top2_LR0.01_FC16_configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml.07_38_06.stT8d46k/imagenet1k/resnet_midlevel_delayed_fc/depth_50/c2_model_iter${i}.pkl
# i=10010
# TAG=conv4_yfcc_init_pca_centroid${i} CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_stage2.yaml NAME=sigma5.0_top2_LR0.01_centroid${i} ./deploy/cluster/launch.sh MIDLEVEL.GAUSSIAN_TOPK 2 MIDLEVEL.GAUSSIAN_SIGMA 5.0 SOLVER.BASE_LR 0.01 MIDLEVEL.CENTROIDS_FILE /home/yihuihe/visouts/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca/sigma5.0_top2_LR0.01_FC16/${i}/centroids TRAIN.PARAMS_FILE /home/yihuihe/20190712/sigma5.0_top2_LR0.01_FC16_configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml.07_38_06.stT8d46k/imagenet1k/resnet_midlevel_delayed_fc/depth_50/c2_model_iter${i}.pkl
# i=latest
# TAG=conv4_yfcc_init_pca_centroid${i} CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_stage2.yaml NAME=sigma5.0_top2_LR0.01_centroid${i} ./deploy/cluster/launch.sh MIDLEVEL.GAUSSIAN_TOPK 2 MIDLEVEL.GAUSSIAN_SIGMA 5.0 SOLVER.BASE_LR 0.01 MIDLEVEL.CENTROIDS_FILE /home/yihuihe/visouts/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca/sigma5.0_top2_LR0.01_FC16/${i}/centroids TRAIN.PARAMS_FILE /home/yihuihe/20190712/sigma5.0_top2_LR0.01_FC16_configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml.07_38_06.stT8d46k/imagenet1k/resnet_midlevel_delayed_fc/depth_50/${i}.pkl

# TAG=conv5_yfcc_init_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv5_yfcc_scratch_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv4_yfcc_init_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv4_yfcc_scratch_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv4_in1k_scratch_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv4_in1k_init_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv5_in1k_init_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000
# TAG=conv5_in1k_scratch_pca_long CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000

TAG=conv4_yfcc_scratch_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv4_in1k_scratch_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv5_yfcc_scratch_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv5_in1k_scratch_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_scratch_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv4_yfcc_init_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv4_in1k_init_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv5_yfcc_init_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv5_in1k_init_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800
TAG=conv4_yfcc_init_scratchconv5_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800 MIDLEVEL.INIT_CONV5 False
TAG=conv4_in1k_init_scratchconv5_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv4_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800 MIDLEVEL.INIT_CONV5 False
TAG=conv5_yfcc_init_scratchconv5_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800 MIDLEVEL.INIT_CONV5 False
TAG=conv5_in1k_init_scratchconv5_pca_longer CFG=configs/unsupervised/midlevel/pretext/resnet/IN1k_8gpu_delayed_BN_bias_decay_shift_scale_conv5_pca_cin1k.yaml bash schd.sh MIDLEVEL.RECLUSTER_PERIOD 100100000 SOLVER.STEP_SIZES '[200200,200200,200200,200200]' SOLVER.NUM_ITERATIONS 800800 MIDLEVEL.INIT_CONV5 False
